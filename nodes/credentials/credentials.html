<script type="text/javascript">
  const NODE_ID = 'connio-credentials';

  const CredentialsNode = {
    category: 'config',
    defaults: {
      connioConfig: {
        type: 'connio-config',
      },
      email: {
        required: true,
      },
    },
    credentials: {
      password: {
        type: 'password',
        required: true,
      },
    },
    label() {
      return this.email;
    },
    oneditsave() {
      const nextConfig = {
        connioConfig: $('#node-config-input-connioConfig').val(),
        email: $('#node-config-input-email').val(),
        password: $('#node-config-input-password').val(),
      };

      if (
        nextConfig.connioConfig !== this.connioConfig ||
        nextConfig.email !== this.email ||
        (nextConfig.password !== '__PWRD__' &&
          nextConfig.password !== this.credentials.password)
      ) {
        RED.events.emit('@credentials/update', nextConfig);
      }
    },
  };

  RED.nodes.registerType(NODE_ID, CredentialsNode);
</script>

<script type="text/x-red" data-template-name="connio-credentials">
  <div class="form-row">
    <label for="node-config-input-connioConfig">
      <i class="fa fa-cog"></i>
      <span data-i18n="configuration-field.label"></span>
    </label>

    <input
      type="text"
      id="node-config-input-connioConfig"
      data-i18n="[placeholder]configuration-field.placeholder"
    >
  </div>

  <hr>

  <div class="form-row">
    <label for="node-config-input-email">
      <i class="fa fa-envelope"></i>
      <span data-i18n="e-mail-field.label"></span>
    </label>

    <input
      type="text"
      id="node-config-input-email"
      data-i18n="[placeholder]e-mail-field.placeholder"
    >
  </div>

  <div class="form-row">
    <label for="node-config-input-password">
      <i class="fa fa-unlock"></i>
      <span data-i18n="password-field.label"></span>
    </label>

    <input
      type="text"
      id="node-config-input-password"
      data-i18n="[placeholder]password-field.placeholder"
    >
  </div>
</script>
